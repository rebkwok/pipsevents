{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="extra-top-margin container-fluid row">
    <div class="col-sm-12">
       <div class="card card-wm">
            <div class="card-header">
                <h2 class="card-title">Your Membership</h2>
            </div>
            <div class="card-body">
                <dl>
                    <dt>Membership</dt>
                    <dd>{{ user_membership.membership }}</dd>
                </dl>
                <dl>
                    <dt>Status</dt>
                    <dd>{{ user_membership.hr_status }} </dd>
                    <dd>
                        {% if user_membership.subscription_status == "past_due" %}
                        <form method="post" action="{% url 'membership_checkout' %}">
                            {% csrf_token %}
                            <input type="hidden" name="subscription_id" value="{{ user_membership.subscription_id }}"/>
                            <div class="form-group">
                               <input class="btn btn-sm btn-wm" type="submit" value="Complete payment" />
                            </div>
                        </form>
                        {% else %}
                            <a href="{% url 'stripe_payments:stripe_portal' user_membership.user.userprofile.stripe_customer_id %}" class="btn btn-sm btn-wm">Update payment method</a><br/>
                            <span class="studioadmin-help">Note: this will open a Stripe portal where you can update the payment method associated with your subscription.</span>
                        {% endif %}
                    </dd>
                </dl>
                <dl>
                    <dt>Next payment due</dt>
                    <dd>{{ next_due|date:"d M Y" }}</dd>
                </dl>
                <dl>
                    <dt>Start date</dt>
                    <dd>{{ user_membership.start_date|date:"d M Y" }}</dd>
                </dl>
                <dl>
                    <dt>End date</dt>
                    <dd>{% if user_membership.end_date %}{{ user_membership.end_date|date:"d M Y" }}{% else %}-{% endif %}</dd>
                </dl>
                <dl>
                    <dt>Bookings this month ({{this_month}})</dt>
                    <dd>
                        {% if user_membership.bookings_this_month %}
                            {% for booking in user_membership.bookings_this_month %}
                                {{ booking.event }}
                            {% endfor %}
                        {% else %}
                            -
                        {% endif %}
                    </dd>
                </dl>
                <dl>
                    <dt>Bookings next month ({{next_month}})</dt>
                    <dd>
                        {% if user_membership.bookings_next_month %}
                            {% for booking in user_membership.bookings_next_month %}
                                {{ booking.event }}
                            {% endfor %}
                        {% else %}
                            -
                        {% endif %}
                    </dd>
                </dl>
            </div>
       </div>

</div>
</div>

{% endblock content %}
